

#ifndef STREAM_H
#define STREAM_H

#include <iostream>
#include <cstdio>

class CStream : public streambuf, public iostream
{
protected:
	int m_iBufSize;
	char* m_pchGetBuf;
	char* m_pchPutBuf;
	
protected:
	CStream(int iBufSize = 512)
			: streambuf(), iostream((streambuf*)this),
			  m_iBufSize(iBufSize), m_pchGetBuf(0), m_pchPutBuf(0)
			{
				AllocateBuffer();
			}
	virtual ~CStream() { FreeBuffer(); }
	
public:
	inline char* GetPtr() { return gptr(); }
	int BufSize() { return m_iBufSize; }
	virtual int sync();	
	
private:
	void AllocateBuffer();
	void FreeBuffer();
};

#endif
